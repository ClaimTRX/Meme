<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CFT Token</title>
  <link rel="icon" href="https://raw.githubusercontent.com/ClaimTRX/Test/main/favicon-32x32.png" type="image/png">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    /* Your existing CSS styles */
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>CFT</h2>
    <a href="index.html">CFT Token</a>
    <a href="Staking.html">USDT Rewards</a>
    <a href="treasury.html">Treasury</a>
    <a href="Swap.html">Swap</a>
    <a href="meme.html">Meme Staking</a>
    <div class="social-links">
        <a href="https://x.com/cfttrc20?s=21" target="_blank" class="social-icon">
            <i class="fab fa-twitter"></i>
        </a>
        <a href="https://t.me/claimfreetrxnow" target="_blank" class="social-icon">
            <i class="fab fa-telegram-plane"></i>
        </a>
    </div>
  </div>
  
  <div class="topbar">
    <button id="connect-button">Connect Wallet</button>
    <span id="user-address" style="margin-left: 15px; color: white;"></span>
  </div>
  
  <div class="main-content">
    <div class="card">
      <div class="card-body">
        <div class="widget-container">
          <div id="jmSwapFrame"></div>
        </div>
        <div class="card-text-section">
          <p class="card-title">JustMoney Swap</p>
          <p>Use the JM Swap widget to swap your favorite tokens. </p>
          <div id="visitText"><a href="https://explorer.just.money/" target="_blank" rel="noopener noreferrer">Visit the new JustMoney Explorer</a></div>
        </div>
      </div>
    </div>
  </div>
   
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.min.js"></script>
  <script src="https://just.money/assets/js/widgetLib-1.1.js"></script>

  <script>
    let tronWeb, userAddress;

    document.addEventListener('DOMContentLoaded', async () => {
      // Set up wallet connect button
      document.getElementById('connect-button').addEventListener('click', connectWallet);

      // Create the JustMoney Swap widget
      window.JmApi.createSwapWidget('jmSwapFrame', {
        type: "SINGLECHAIN",
        network: "TRON",
        tokens: [
          "TRX", "JM", "USDT", "BBC", "BBT", "BTC", "BTT", "CCC", "ERG", "ETH", "PROS", "TBT", "TNT", "TEM", "TRNGUY", "USTX"
        ],
        fromToken: "TRX",
        toToken: "USDT",
        affiliateFeeAddressTron: "TMLURq9ZZpiMxT2auN1vNCkLvfkXAPanHY",
        liquidityTab: false,
        showChart: true,
        chartBackgroundColor: "#353740",
        lightBranding: true,
        backgroundColor: "#e8e5f2",
        buttonStyle: "background-color:#754ef9;color:#ffffff;",
        maxButtonStyle: "background-color:#ffffff;color:#000000;",
        headingStyle: "color:#754ef9;",
        textColor: "#000000",
        inputContainerStyle: "background-color:#754ef9;color:#ffffff;",
        inputContainerInputStyle: "color: #ffffff;",
        inputContainerInputPlaceholderStyle: "color: #ffffff;opacity: 0.5;"
      });

      if (await checkTronLinkInstalled()) {
        await initializeTronWeb();
      } else {
        console.error('TronLink is not installed.');
      }
    });

    // Check if TronLink is installed
    async function checkTronLinkInstalled() {
      return new Promise((resolve) => {
        const interval = setInterval(() => {
          if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
            clearInterval(interval);
            resolve(true);
          }
        }, 1000);
      });
    }

    // Connect the wallet using TronLink
    async function connectWallet() {
      try {
        await tronLink.request({ method: 'tron_requestAccounts' });
        await initializeTronWeb();
      } catch (e) {
        console.error('Failed to connect to TronLink:', e);
      }
    }

    // Initialize TronWeb and update UI
    async function initializeTronWeb() {
      try {
        tronWeb = window.tronWeb;
        userAddress = tronWeb.defaultAddress.base58;

        if (!userAddress) throw new Error('User address not available');

        console.log('Connected to TronLink.');
        console.log('User Address:', userAddress);

        // Hide connect wallet button once connected
        document.getElementById('connect-button').style.display = 'none';

        // Display user address in the topbar
        document.getElementById('user-address').textContent = `Connected: ${userAddress}`;

        // Optionally, update the balance or other info
        await updateBalance();
      } catch (error) {
        console.error('Error initializing TronWeb:', error);
      }
    }

    // Update the user's balance (optional)
    async function updateBalance() {
      try {
        const balance = await tronWeb.trx.getBalance(userAddress);
        console.log('Balance:', tronWeb.fromSun(balance), 'TRX');
        // Optionally, display the balance in the UI
      } catch (error) {
        console.error('Error updating balance:', error);
      }
    }
  </script>
</body>
</html>

